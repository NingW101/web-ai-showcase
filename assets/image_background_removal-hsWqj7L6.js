import{s as U,a as N}from"./navigation-BcvLzd7M.js";import{e as L,a as z,R as I}from"./image-O15s_1zf.js";import{A as F}from"./processors-De2tF4GJ.js";import{g as Q,d as V,a as q,i as G,f as h,c as A,r as S,h as j,b as C}from"./utility-CeoLs25M.js";import{A as H}from"./config-YF015oXS.js";const J=""+new URL("person.avif",import.meta.url).href;U("../..");N("../..");L.allowLocalModels=!1;L.allowRemoteModels=!0;L.backends.onnx.wasm.proxy=!1;const O="transformers-cache",y="BiRefNet_T",_="onnx-community/BiRefNet_T",W=document.getElementById("upload"),c=document.getElementById("container"),X=document.getElementById("example"),B=document.getElementById("loadModelPromptContent"),w=document.getElementById("loadingModelText"),f=document.getElementById("progress"),E=document.getElementById("progressBar"),Y=document.getElementById("loadModelBtn"),K=document.getElementById("modelPopover"),Z=document.getElementById("modelPanelWrapper"),M=Q(y),i=V(y);let T=0,R=null,b=null;function ee(e){const t=e.file;let n=null;switch(t&&(n=document.getElementById(`${t.match(/\/?([^/.]+?)(?:\.[^/.]+)?$/)[1]}StatusBar`)),e.status){case"download":if(n){T=new Date().getTime();const o=e.file;if(i[o]&&i[o].cached)return;S(w,f),f.appendChild(j(`<div model="${e.name}" file="${e.file}"
         class="relative 2xl:my-2 my-1 2xl:rounded-2xl rounded-lg w-full 2xl:min-h-[30px] min-h-[20px] bg-stone-200/40 flex items-center justify-between font-mono"
      >
    <div class="relative px-2 z-20 2xl:text-sm text-xs" name="statusText"></div>
    <div class="relative px-2 z-20 2xl:text-sm text-xs">
      <span name="progressVal">0%</span>
    </div>
    <div
      name="progressBar"
      class="absolute top-0 2xl:rounded-2xl rounded-lg z-10 text-right bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 2xl:min-h-[30px] min-h-[20px] "
    ></div>
    </div>`))}break;case"progress":if(n)if(i[e.file]&&i[e.file].cached){n.textContent="loading",A("loading",n),i[e.file].size=e.total;break}else{n.textContent="downloading",A("loading",n),i[e.file].size=e.total;const o=f.querySelector(`div[model="${e.name}"][file="${e.file}"]`);if(o!==null){const s=o.querySelector("div[name='statusText']"),a=o.querySelector("div[name='progressBar']"),l=o.querySelector("span[name='progressVal']");a.style.height||(a.style.height="100%"),a.style.width=e.progress.toFixed(2)+"%",l.textContent=e.progress.toFixed(2)+"%",s.textContent=`${e.file} (${h(e.loaded)} / ${h(e.total)})`;break}}break;case"done":{f.classList.contains("hidden")||f.classList.add("hidden"),w.classList.contains("hidden")||w.classList.add("hidden");let o=new Date().getTime();if(n){let s="downloaded",a=0;i[e.file]&&(a=i[e.file].size,i[e.file].cached&&(s="cache loaded")),n.textContent=`${s} in ${((o-T)/1e3).toFixed(2)}s(${h(a)})`,A("loaded",n),a=0}break}}}X.addEventListener("click",e=>{e.preventDefault(),$(J)});W.addEventListener("change",function(e){const t=e.target.files[0];if(!t)return;const n=new FileReader;n.onload=o=>$(o.target.result),n.readAsDataURL(t)});function D(){document.querySelectorAll(".control-entry").forEach(e=>{e.classList.toggle("opacity-25"),e.classList.toggle("cursor-pointer");const t=e.querySelector("input");t&&(t.disabled=!t.disabled),e.disabled=!e.disabled})}q(y,Z);function te(){H[y].resources.map(e=>{const t=C(e),n=document.getElementById(`uploadInput4${t}`);n&&n.addEventListener("change",async function(o){const s=o.target.files;if(!s.length)return;const a=await caches.open(O);for(const l of s){const p=new FileReader;p.onprogress=function(d){if(d.lengthComputable){const r=d.loaded,u=d.total;S(E),E.innerHTML=`
            <div class="relative px-2 z-20 2xl:text-sm text-xs" id="StatusText"></div>
            <div class="relative px-2 z-20 2xl:text-sm text-xs">
              <span id="ProgressVal">0%</span>
            </div>
            <div
              id="ProgressBar"
              class="absolute top-0 rounded-2xl 2xl:text-sm text-xs z-10 text-right bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"
            ></div>
         `;const m=document.getElementById("StatusText"),g=document.getElementById("ProgressBar"),v=document.getElementById("ProgressVal");let x=r/u*100;m.textContent="Uploading model ...",g.style.height||(g.style.height="100%"),g.style.width=`${x}%`,v.textContent=`${h(r)}/${h(u)}`}},p.onload=async function(d){const r=d.target.result,u=new Blob([r]),g=(l.name.split(".").length>0?l.name.split(".")[1]:"")==="json"?"text/plain; charset=utf-8":"binary/octet-stream",v=new Response(u,{headers:{"Content-Length":u.size.toString(),"Accept-Ranges":"bytes","Content-Type":g}}),x=M+e;await a.match(x)||a.put(x,v).then(()=>{console.log(`cache ${e} successfully.`),P()}).catch(k=>{console.error(`cache ${e} failed:`,k)}),E.classList.contains("hidden")||E.classList.add("hidden")},p.readAsArrayBuffer(l)}})})}te();async function $(e){D();try{R||(R=await z.from_pretrained(_,{progress_callback:ee,device:"webgpu",dtype:"fp32"})),b||(b=await F.from_pretrained(_,{device:"webgpu",dtype:"fp32"}));const t=await I.fromURL(e);c.innerHTML=`<div id="loadingIcon" class="absolute_center">
  <div class="lds-ripple">
    <div></div>
    <div></div>
  </div>
</div>`,c.style.backgroundImage=`url(${e})`,c.style.backgroundSize="100% 100%",c.style.backgroundRepeat="no-repeat";const n=t.width/t.height;let[o,s]=[0,0];window.innerWidth>=1536?[o,s]=n>720/480?[720,720/n]:[480*n,480]:[o,s]=n>480/320?[480,480/n]:[320*n,320],c.style.width=`${o}px`,c.style.height=`${s}px`;const{pixel_values:a}=await b(t),{output:l}=await R({input:a}),p=await I.fromTensor(l[0].mul(255).to("uint8")).resize(t.width,t.height),d=document.createElement("canvas");d.width=t.width,d.height=t.height;const r=d.getContext("2d");r.drawImage(t.toCanvas(),0,0);const u=r.getImageData(0,0,t.width,t.height);for(let m=0;m<p.data.length;++m)u.data[4*m+3]=p.data[m];r.putImageData(u,0,0),c.append(d),c.style.removeProperty("background-image"),c.style.background='url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAGUExURb+/v////5nD/3QAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAUSURBVBjTYwABQSCglEENMxgYGAAynwRB8BEAgQAAAABJRU5ErkJggg==")',D(),document.getElementById("loadingIcon").classList.toggle("hidden")}catch(t){console.log("Error:",t)}}async function P(){let e=await caches.open(O);for(const t of Object.keys(i)){let n="",o="";const s=M+t,a=await e.match(s),l=document.getElementById(`${t.match(/\/?([^/.]+?)(?:\.[^/.]+)?$/)[1]}StatusBar`);!a||!a.ok?(n="unload",o="unload"):(n="cached",o="cache available",i[t].cached=!0,B&&!B.classList.contains("hidden")&&B.classList.add("hidden"),S(document.getElementById(`${C(t)}StatusFlag`))),l&&(A(n,l),l.textContent=o)}}await P();G(Y,K);
