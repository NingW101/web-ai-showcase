import{s as z,a as F}from"./navigation-BcvLzd7M.js";import{g as O,d as j,r as I,h as G,b as R,f,c as B,a as q,i as H}from"./utility-CeoLs25M.js";import{A as V}from"./config-YF015oXS.js";import{W}from"./worker-C-kcemA_.js";const X=""+new URL("cats.png",import.meta.url).href;z("../..");F("../..");const P=new W,A="transformers-cache",E="vit-gpt2-image-captioning",K=document.getElementById("upload"),L=document.getElementById("image-wrapper"),M=document.getElementById("image2text-output-textbox"),g=document.getElementById("progress"),Q=document.getElementById("example"),c=document.getElementById("status"),b=document.getElementById("loadModelPromptContent"),v=document.getElementById("loadingModelText"),J=document.getElementById("loadModelBtn"),Y=document.getElementById("modelPopover"),y=document.getElementById("progressBar"),Z=document.getElementById("modelPanelWrapper"),ee=O(E),o=j(E);let w=0,p=null,_=null;const D={max_new_tokens:50,num_beams:1,temperature:1,top_k:0,do_sample:!1};for(const[t,e]of Object.entries(D))document.getElementById(t).value=e;function te(){let t={};for(const[e,n]of Object.entries(D)){const a=document.getElementById(e);a&&a.value!==void 0&&(e==="do_sample"?t[e]=a.value==="true":t[e]=parseInt(a.value))}return t}function $(){const t=M.value;t===_?(S(),c.parentElement.classList.toggle("hidden"),c.textContent="",p=null):(_=t,clearTimeout(p),p=setTimeout($,1500))}Q.addEventListener("click",t=>{t.preventDefault();const e=new Image;e.onload=function(){c.textContent="Generating ... ",c.parentElement.classList.toggle("hidden"),S(),w=new Date().getTime(),k(e)},e.classList.add("object-contain","w-full"),e.src=X,L.innerHTML="",L.appendChild(e)});K.addEventListener("change",t=>{const e=t.target.files[0],n=URL.createObjectURL(e),a=new Image;a.onload=function(){c.textContent="Generating",c.parentElement.classList.toggle("hidden"),S(),w=new Date().getTime(),k(a)},a.classList.add("object-contain","w-full"),a.src=n,L.innerHTML="",L.appendChild(a)});function ae(t){const e=document.createElement("canvas");return e.width=t.naturalWidth,e.height=t.naturalHeight,e.getContext("2d").drawImage(t,0,0,e.width,e.height),e.toDataURL()}function S(){document.querySelectorAll(".control-entry").forEach(t=>{t.classList.toggle("opacity-25"),t.classList.toggle("cursor-pointer");const e=t.querySelector("input");e&&(e.disabled=!e.disabled),t.disabled=!t.disabled})}function k(t){let e={baseURI:document.baseURI,task:"image-to-text",generation:te(),image:ae(t),elementIdToUpdate:M.id};P.postMessage(e)}P.addEventListener("message",t=>{if(!t.data)return;const e=t.data;switch(e.type){case"download":if(e.data.status==="initiate"){if(!e.data.file||e.data.file.split(".").length>0&&e.data.file.split(".")[1]!=="onnx"||!o[e.data.file]||o[e.data.file].cached)break;I(v,g),g.appendChild(G(`<div model="${e.data.name}" file="${e.data.file}"
        class="relative 2xl:my-2 my-1 2xl:rounded-2xl rounded-lg w-full 2xl:min-h-[30px] min-h-[20px] bg-stone-200/40 flex items-center justify-between font-mono"
      >
    <div class="relative px-2 z-20 2xl:text-sm text-xs" name="statusText"></div>
    <div class="relative px-2 z-20 2xl:text-sm text-xs">
      <span name="progressVal">0%</span>
    </div>
    <div
      name="progressBar"
      class="absolute top-0 2xl:rounded-2xl rounded-lg z-10 text-right bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 2xl:min-h-[30px] min-h-[20px] "
    ></div>
    </div>`))}else{if(e.data.status==="ready"){g.classList.contains("hidden")||g.classList.add("hidden"),v.classList.contains("hidden")||v.classList.add("hidden");break}const n=g.querySelector(`div[model="${e.data.name}"][file="${e.data.file}"]`),a=document.getElementById(`${e.data.file.match(/\/?([^/.]+?)(?:\.[^/.]+)?$/)[1]}StatusBar`);switch(e.data.status){case"progress":{if(!e.data.file||!o[e.data.file])break;const l=e.data.file;if(a){if(o[l].cached){a.textContent="loading",B("loading",a),typeof e.data.total=="number"&&!isNaN(e.data.total)&&e.data.total>0&&(o[l].size=e.data.total);break}else if(a.textContent="downloading",B("loading",a),typeof e.data.total=="number"&&!isNaN(e.data.total)&&e.data.total>0&&(o[l].size=e.data.total),n!==null){const d=n.querySelector("div[name='statusText']"),s=n.querySelector("div[name='progressBar']"),i=n.querySelector("span[name='progressVal']");s.style.height||(s.style.height="100%"),s.style.width=e.data.progress.toFixed(2)+"%",i.textContent=e.data.progress.toFixed(2)+"%",d.textContent=`${e.data.file} (${f(e.data.loaded)} / ${f(e.data.total)})`}}break}case"done":{if(!e.data.file||!o[e.data.file])break;let l=new Date().getTime();if(n!==null&&n.classList.add("hidden"),I(document.getElementById(`${R(e.data.file)}StatusFlag`)),a){let d="downloaded",s=0;const i=e.data.file;o[i]&&(s=o[i].size,o[i].cached&&(d="cache loaded")),a.textContent=`${d} in ${((l-w)/1e3).toFixed(2)}s(${f(s)})`,B("loaded",a),s=0}break}}}break;case"update":{let n=e.target,a=document.getElementById(n);a.value=e.data,p||(_=document.getElementById(n).value,p=setTimeout($,1500));break}case"complete":document.getElementById(e.target).value=e.data;break}});q(E,Z);function ne(){V[E].resources.map(t=>{const e=R(t),n=document.getElementById(`uploadInput4${e}`);n&&n.addEventListener("change",async function(a){const l=a.target.files;if(!l.length)return;const d=await caches.open(A);for(const s of l){const i=new FileReader;i.onprogress=function(r){if(r.lengthComputable){const h=r.loaded,m=r.total;I(y),y.innerHTML=`
              <div class="relative px-2 z-20 2xl:text-sm text-xs" id="StatusText"></div>
            <div class="relative px-2 z-20 2xl:text-sm text-xs">
              <span id="ProgressVal">0%</span>
            </div>
            <div
              id="ProgressBar"
              class="absolute top-0 rounded-2xl 2xl:text-sm text-xs z-10 text-right bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"
            ></div>
         `;const C=document.getElementById("StatusText"),u=document.getElementById("ProgressBar"),T=document.getElementById("ProgressVal");let x=h/m*100;C.textContent="Uploading model ...",u.style.height||(u.style.height="100%"),u.style.width=`${x}%`,T.textContent=`${f(h)}/${f(m)}`}},i.onload=async function(r){const h=r.target.result,m=new Blob([h]),u=(s.name.split(".").length>0?s.name.split(".")[1]:"")==="json"?"text/plain; charset=utf-8":"binary/octet-stream",T=new Response(m,{headers:{"Content-Length":m.size.toString(),"Accept-Ranges":"bytes","Content-Type":u}}),x=O(E)+t;await d.match(x)||d.put(x,T).then(()=>{console.log(`cache ${t} successfully.`),U()}).catch(N=>{console.error(`cache ${t} failed:`,N)}),y.classList.contains("hidden")||y.classList.add("hidden")},i.readAsArrayBuffer(s)}})})}ne();async function U(){let t=await caches.open(A);for(const e of Object.keys(o)){let n="",a="";const l=ee+e,d=await t.match(l),s=document.getElementById(`${e.match(/\/?([^/.]+?)(?:\.[^/.]+)?$/)[1]}StatusBar`);!d||!d.ok?(n="unload",a="unload"):(n="cached",a="cache available",o[e].cached=!0,b&&!b.classList.contains("hidden")&&b.classList.add("hidden"),I(document.getElementById(`${R(e)}StatusFlag`))),s&&(B(n,s),s.textContent=a)}}await U();H(J,Y);
