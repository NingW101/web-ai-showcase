import{s as C,a as $}from"./navigation-BcvLzd7M.js";import{g as M,d as k,r as x,h as N,b as I,f,c as h,a as D,i as U}from"./utility-CeoLs25M.js";import{W as z}from"./worker-C-kcemA_.js";import{A as F}from"./config-YF015oXS.js";C("../..");$("../..");const O="transformers-cache",y="distilbart-cnn-6-6",L=new z,j=document.getElementById("summarizationInput"),_=document.getElementById("summarizationOutput"),u=document.getElementById("progress"),V=document.getElementById("triggerBtn"),v=document.getElementById("loadingModelText"),T=document.getElementById("loadModelPromptContent"),E=document.getElementById("progressBar"),X=document.getElementById("loadModelBtn"),q=document.getElementById("modelPopover"),G=document.getElementById("modelPanelWrapper"),R=M(y),o=k(y),S={max_new_tokens:50,num_beams:2,temperature:1,top_k:0,do_sample:!1};for(const[s,e]of Object.entries(S))document.getElementById(s).value=e;function W(){let s={};for(const[e,t]of Object.entries(S)){const a=document.getElementById(e);a&&a.value!==void 0&&(e==="do_sample"?s[e]=a.value==="true":s[e]=parseInt(a.value))}return s}let P=0;V.addEventListener("click",async s=>{_.value="";const e={baseURI:document.baseURI,task:"summarization",generation:W(),text:j.value,elementIdToUpdate:_.id};P=new Date().getTime(),L.postMessage(e)});L.addEventListener("message",s=>{if(!s.data)return;const e=s.data;switch(e.type){case"download":if(e.data.status==="initiate"){if(!e.data.file||e.data.file.split(".").length>0&&e.data.file.split(".")[1]!=="onnx"||!o[e.data.file]||o[e.data.file].cached)break;const t=e.data.file;if(o[t].cached)break;x(v,u),u.appendChild(N(`<div model="${e.data.name}" file="${e.data.file}"
        class="relative 2xl:my-2 my-1 2xl:rounded-2xl rounded-lg w-full 2xl:min-h-[30px] min-h-[20px] bg-stone-200/40 flex items-center justify-between font-mono"
      >
    <div class="relative px-2 z-20 2xl:text-sm text-xs" name="statusText"></div>
    <div class="relative px-2 z-20 2xl:text-sm text-xs">
      <span name="progressVal">0%</span>
    </div>
    <div
      name="progressBar"
      class="absolute top-0 2xl:rounded-2xl rounded-lg z-10 text-right bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 2xl:min-h-[30px] min-h-[20px] "
    ></div>
    </div>`))}else{if(e.data.status==="ready"){u.classList.contains("hidden")||u.classList.add("hidden"),v.classList.contains("hidden")||v.classList.add("hidden");break}const t=document.getElementById(`${e.data.file.match(/\/?([^/.]+?)(?:\.[^/.]+)?$/)[1]}StatusBar`),a=u.querySelector(`div[model="${e.data.name}"][file="${e.data.file}"]`);switch(e.data.status){case"progress":{if(!e.data.file||!o[e.data.file])break;const d=e.data.file;if(t){if(o[d]&&o[d].cached){t.textContent="loading",h("loading",t),typeof e.data.total=="number"&&!isNaN(e.data.total)&&e.data.total>0&&(o[d].size=e.data.total);return}else if(t.textContent="downloading",h("loading",t),typeof e.data.total=="number"&&!isNaN(e.data.total)&&e.data.total>0&&(o[d].size=e.data.total),a!==null){const l=a.querySelector("div[name='statusText']"),n=a.querySelector("div[name='progressBar']"),i=a.querySelector("span[name='progressVal']");n.style.height||(n.style.height="100%"),n.style.width=e.data.progress.toFixed(2)+"%",i.textContent=e.data.progress.toFixed(2)+"%",l.textContent=`${e.data.file} (${f(e.data.loaded)} / ${f(e.data.total)})`}}break}case"done":{let d=new Date().getTime();if(a!==null&&a.classList.add("hidden"),x(document.getElementById(`${I(e.data.file)}StatusFlag`)),t){let l="downloaded",n=0;const i=e.data.file;o[i]&&(n=o[i].size,o[i].cached&&(l="cache loaded")),t.textContent=`${l} in ${((d-P)/1e3).toFixed(2)}s(${f(n)})`,h("loaded",t),n=0}break}}}break;case"update":{let t=e.target,a=document.getElementById(t);a.value=e.data;break}case"complete":document.getElementById(e.target).value=e.data;break}});D(y,G);function H(){F[y].resources.map(s=>{const e=I(s),t=document.getElementById(`uploadInput4${e}`);t&&t.addEventListener("change",async function(a){const d=a.target.files;if(!d.length)return;const l=await caches.open(O);for(const n of d){const i=new FileReader;i.onprogress=function(c){if(c.lengthComputable){const g=c.loaded,r=c.total;x(E),E.innerHTML=`
             <div class="relative px-2 z-20 2xl:text-sm text-xs" id="StatusText"></div>
            <div class="relative px-2 z-20 2xl:text-sm text-xs">
              <span id="ProgressVal">0%</span>
            </div>
            <div
              id="ProgressBar"
              class="absolute top-0 rounded-2xl 2xl:text-sm text-xs z-10 text-right bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"
            ></div>
         `;const b=document.getElementById("StatusText"),m=document.getElementById("ProgressBar"),B=document.getElementById("ProgressVal");let p=g/r*100;b.textContent="Uploading model ...",m.style.height||(m.style.height="100%"),m.style.width=`${p}%`,B.textContent=`${f(g)}/${f(r)}`}},i.onload=async function(c){const g=c.target.result,r=new Blob([g]),m=(n.name.split(".").length>0?n.name.split(".")[1]:"")==="json"?"text/plain; charset=utf-8":"binary/octet-stream",B=new Response(r,{headers:{"Content-Length":r.size.toString(),"Accept-Ranges":"bytes","Content-Type":m}}),p=R+s;await l.match(p)||l.put(p,B).then(()=>{console.log(`cache ${s} successfully.`),w()}).catch(A=>{console.error(`cache ${s} failed:`,A)}),E.classList.contains("hidden")||E.classList.add("hidden")},i.readAsArrayBuffer(n)}})})}H();async function w(){let s=await caches.open(O);for(const e of Object.keys(o)){let t="",a="";const d=R+e,l=await s.match(d),n=document.getElementById(`${e.match(/\/?([^/.]+?)(?:\.[^/.]+)?$/)[1]}StatusBar`);!l||!l.ok?(t="unload",a="unload"):(t="cached",a="cache available",o[e].cached=!0,T&&!T.classList.contains("hidden")&&T.classList.add("hidden"),x(document.getElementById(`${I(e)}StatusFlag`))),n&&(h(t,n),n.textContent=a)}}await w();U(X,q);
